{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://intentsolutions.io/schemas/catalog.schema.json",
  "title": "Intent Catalog Schema",
  "description": "Data contract for plugins, skills, and documents across Intent Solutions repos",
  "version": "1.0.0",
  "type": "object",
  "required": ["meta", "plugins", "skills", "documents", "relationships"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "Extraction metadata",
      "required": ["version", "extracted_at", "repos"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Schema version (semver)"
        },
        "extracted_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of extraction"
        },
        "repos": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["path", "name"],
            "properties": {
              "path": { "type": "string" },
              "name": { "type": "string" },
              "commit": { "type": "string" }
            }
          }
        }
      }
    },
    "plugins": {
      "type": "array",
      "items": { "$ref": "#/$defs/Plugin" }
    },
    "skills": {
      "type": "array",
      "items": { "$ref": "#/$defs/Skill" }
    },
    "documents": {
      "type": "array",
      "items": { "$ref": "#/$defs/Document" }
    },
    "relationships": {
      "type": "array",
      "items": { "$ref": "#/$defs/Relationship" }
    },
    "warnings": {
      "type": "array",
      "items": { "$ref": "#/$defs/Warning" }
    }
  },
  "$defs": {
    "Plugin": {
      "type": "object",
      "required": ["plugin_id", "name", "path", "source_repo"],
      "properties": {
        "plugin_id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "Unique plugin identifier (kebab-case)"
        },
        "name": {
          "type": "string",
          "description": "Display name"
        },
        "description": {
          "type": "string"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "path": {
          "type": "string",
          "description": "Relative path from repo root"
        },
        "source_repo": {
          "type": "string",
          "description": "Which repo this came from"
        },
        "status": {
          "type": "string",
          "enum": ["production", "development", "archived", "deprecated"]
        },
        "has_mcp": {
          "type": "boolean"
        },
        "commands": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of command names"
        },
        "agents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of agent names"
        }
      }
    },
    "Skill": {
      "type": "object",
      "required": ["skill_id", "name", "path", "source_repo"],
      "properties": {
        "skill_id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "Unique skill identifier (kebab-case)"
        },
        "name": {
          "type": "string",
          "description": "From SKILL.md frontmatter"
        },
        "description": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "path": {
          "type": "string",
          "description": "Relative path to SKILL.md"
        },
        "source_repo": {
          "type": "string"
        },
        "allowed_tools": {
          "type": "string",
          "description": "Comma-separated tool list"
        },
        "author": {
          "type": "string"
        },
        "license": {
          "type": "string"
        },
        "trigger_phrases": {
          "type": "array",
          "items": { "type": "string" }
        },
        "is_standalone": {
          "type": "boolean",
          "description": "True if not part of a plugin"
        },
        "has_references": {
          "type": "boolean"
        },
        "has_assets": {
          "type": "boolean"
        },
        "has_scripts": {
          "type": "boolean"
        }
      }
    },
    "Document": {
      "type": "object",
      "required": ["doc_id", "path", "source_repo"],
      "properties": {
        "doc_id": {
          "type": "string",
          "description": "Extracted from filename or generated"
        },
        "title": {
          "type": "string"
        },
        "doc_type": {
          "type": "string",
          "enum": [
            "spec", "decision", "report", "use_case", "evidence",
            "runbook", "security", "marketing", "architecture",
            "planning", "audit", "guide", "reference", "unknown"
          ]
        },
        "category_code": {
          "type": "string",
          "description": "e.g., OD-ARCH, PP-PLAN, AA-AACR"
        },
        "path": {
          "type": "string"
        },
        "source_repo": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": ["draft", "review", "approved", "obsolete", "unknown"]
        }
      }
    },
    "Relationship": {
      "type": "object",
      "required": ["source_type", "source_id", "target_type", "target_id", "relation_type"],
      "properties": {
        "source_type": {
          "type": "string",
          "enum": ["plugin", "skill", "document"]
        },
        "source_id": {
          "type": "string"
        },
        "target_type": {
          "type": "string",
          "enum": ["plugin", "skill", "document"]
        },
        "target_id": {
          "type": "string"
        },
        "relation_type": {
          "type": "string",
          "enum": [
            "ships_with", "depends_on", "invokes", "recommends", "embeds",
            "spec", "decision", "report", "use_case", "evidence", "runbook", "security", "marketing"
          ]
        },
        "confidence": {
          "type": "string",
          "enum": ["manual", "inferred"],
          "default": "inferred"
        }
      }
    },
    "Warning": {
      "type": "object",
      "required": ["path", "message"],
      "properties": {
        "path": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "severity": {
          "type": "string",
          "enum": ["error", "warning", "info"],
          "default": "warning"
        }
      }
    }
  }
}
